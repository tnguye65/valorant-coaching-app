// prisma/schema.prisma

generator client {
  provider = "prisma-client-js"
}

generator json {
  provider = "prisma-json-types-generator"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

// 1. The User (Handles both You and Students)
model User {
  id          String  @id @default(uuid())
  email       String  @unique
  name        String?
  imageUrl    String?
  clerkUserId String  @unique // Links to Clerk Auth
  role        String  @default("student") // 'coach' or 'student'

  // Game Stats
  gamertag   String?
  rank       String?  @default("Unranked")
  mainAgents String[]

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // Relationships
  roadmaps Roadmap[]
  sessions Session[]
}

// 2. The Roadmap (A plan assigned to a student)
model Roadmap {
  id     String @id @default(uuid())
  title  String // e.g. "Road to Diamond"
  status String @default("active") // 'active', 'completed', 'archived'

  studentId String
  student   User   @relation(fields: [studentId], references: [id])

  tasks RoadmapTask[]

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

// 3. The Tasks (Individual checkboxes in a roadmap)
model RoadmapTask {
  id          String  @id @default(uuid())
  title       String // e.g. "Practice Strafing"
  description String? // Optional details or links
  isCompleted Boolean @default(false)

  roadmapId String
  roadmap   Roadmap @relation(fields: [roadmapId], references: [id], onDelete: Cascade)
}

// 4. Sessions (Replaces VODs - The history of your coaching)
model Session {
  id     String @id @default(uuid())
  status String @default("pending") // 'pending', 'completed', 'canceled'
  title  String // Optional title for the session

  // VOD review details
  vodLink String // YouTube/Medal link

  agent String // Agent focused on during the session
  map   String // Map focused on during the session

  // Timestamped questions from students
  sessionNotes Note[]

  date      DateTime @default(now())
  studentId String
  student   User     @relation(fields: [studentId], references: [id])
}

model Note {
  id String @id @default(uuid())

  // Students set timestamped questions for coaches to answer later
  timestamp Int
  question  String
  answer    String?

  // New: Link back to the Session
  sessionId String
  session   Session @relation(fields: [sessionId], references: [id], onDelete: Cascade)
}
